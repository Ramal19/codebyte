<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Render data.json</title>
  <style>
    body{font-family:Inter,Segoe UI,Arial,sans-serif;margin:24px}
    h1{font-size:20px;margin-bottom:8px}
    .info{margin-bottom:16px}
    table{border-collapse:collapse;width:100%;max-width:1000px}
    th,td{border:1px solid #ddd;padding:8px;text-align:left}
    th{background:#f6f6f6}
    pre{background:#f3f3f3;padding:12px;overflow:auto}
    .muted{color:#666;font-size:13px}
    .controls{margin:12px 0}
    button{padding:8px 12px;border-radius:6px;border:1px solid #bbb;background:#fff;cursor:pointer}
  </style>
</head>
<body>
  <h1>Render data.json</h1>
  <p class="info">This page reads an array of user objects and displays them in a table while preserving the original structure.</p>
  <div class="controls">
    <button id="tryFetch">Try fetching <code>data.json</code></button>
    <button id="downloadJson">Download current JSON</button>
  </div>

  <div id="output"></div>

  <script>
    // Provided JSON fallback (keeps the same structure you sent)
    const fallbackData = [
      { "username": "111", "password": "$2b$10$g./T/41wHX2pubN5f2SsqOtO68w/ZxNkFdGDu0fVB9YRcoHBaCZ06", "role": "user" },
      { "username": "Ramal", "password": "$2b$10$CitNqixDOmHuqgQbNjfN9uPBlUmffV4FRcaISPU4v7YnQXj4whbTO", "role": "user" },
      { "username": "12", "email": "ld4xz51vd@code.edu.az", "password": "$2b$10$0DMwJSoryQw6cNI.H2FQc.yvqk4QfaIpqSqaftjQljfAvhW0Y31tG", "role": "user" }
    ];

    const output = document.getElementById('output');
    const tryFetchBtn = document.getElementById('tryFetch');
    const downloadBtn = document.getElementById('downloadJson');

    // Render function: shows both pretty JSON and a table preserving keys
    function render(data){
      // Pretty JSON
      const pre = document.createElement('pre');
      pre.textContent = JSON.stringify(data, null, 2);

      // Build table columns from union of all keys to preserve structure
      const keys = Array.from(data.reduce((s, item) => { Object.keys(item).forEach(k => s.add(k)); return s; }, new Set()));

      const table = document.createElement('table');
      const thead = document.createElement('thead');
      const thr = document.createElement('tr');
      keys.forEach(k => { const th = document.createElement('th'); th.textContent = k; thr.appendChild(th); });
      thead.appendChild(thr);
      table.appendChild(thead);

      const tbody = document.createElement('tbody');
      data.forEach(item => {
        const tr = document.createElement('tr');
        keys.forEach(k => {
          const td = document.createElement('td');
          // show missing keys as empty string to preserve structure
          td.textContent = (k in item) ? String(item[k]) : '';
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);

      output.innerHTML = '';
      const meta = document.createElement('div');
      meta.className = 'muted';
      meta.textContent = `Items: ${data.length} â€” Columns: ${keys.join(', ')}`;
      output.appendChild(meta);
      output.appendChild(table);
      output.appendChild(document.createElement('hr'));
      output.appendChild(pre);
    }

    // Try to fetch data.json from same folder; falls back to inline data on error
    async function loadFromJson(){
      try{
        const resp = await fetch('backend/users.json', {cache: 'no-store'});
        if(!resp.ok) throw new Error('Not found or network error');
        const data = await resp.json();
        render(data);
      }catch(err){
        // fallback
        render(fallbackData);
      }
    }

    // download currently shown JSON
    downloadBtn.addEventListener('click', () => {
      const blob = new Blob([output.querySelector('pre').textContent], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'exported_data.json';
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    });

    tryFetchBtn.addEventListener('click', loadFromJson);

    // Auto-load: try fetch, but if run from file:// the fetch will likely fail and fallback will be used
    loadFromJson();
  </script>
</body>
</html>
